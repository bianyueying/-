<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>后台管理-登陆</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" th:href="@{/static/css/style.css}">
    <link rel="stylesheet" th:href="@{/static/layui/css/layui.css}" media="all">
    <link rel="stylesheet" th:href="@{/static/css/login.css}">
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>

<div class="layui-container" >
    <div class="admin-login-background layui-anim layui-anim-upbit" id="login-form" style="display: flow">
        <div class="layui-form login-form">
            <form class="layui-form" action="">
                <div class="layui-form-item logo-title">
                    <h1>后台系统登录页</h1>
                </div>
                <div class="layui-form-item">
                    <label class="layui-icon layui-icon-username"></label>
                    <input type="text" id="username" name="username" required lay-verify="required" placeholder="账号" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-item">
                    <label class="layui-icon layui-icon-password"></label>
                    <input type="password" id="password" name="password" required lay-verify="required" placeholder="密码" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <div class="layui-input-inline" style="width: 178px;">
                            <label class="layui-icon layui-icon-vercode"></label>
                            <input type="text" id="code" name="code" required lay-verify="required" placeholder="请输入验证码" autocomplete="off" class="layui-input">
                        </div>
                        <img id="codeImage" src="http://localhost:8080/user/captcha" width="120px" height="48px" style="margin-top: -5px"  alt="点我更换" onclick="this.src='http://localhost:8080/user/captcha?'+Math.random()"/>
                    </div>
                </div>

                <div class="layui-form-item" style="margin-top: -15px;">
                    <input type="checkbox" name="rememberMe" lay-skin="primary" title="记住我">
                </div>

                <div class="layui-form-item">
                    <button class="layui-btn layui-btn-fluid" lay-submit="" lay-filter="login">登 录</button>
                </div>
                <hr class="layui-bg-green"/>
                <p><a href="javascript:void(0);" onclick="register()" class="fr">立即注册</a></p><br>
            </form>
        </div>
    </div>

    <div class="admin-login-background layui-anim layui-anim-upbit" id="register-form" style="display: none">
        <div class="layui-form login-form">
            <form class="layui-form" action="" method="post">
                <div class="layui-form-item logo-title">
                    <h1>注册页</h1>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline" style="float: left">
                        <label class="layui-icon layui-icon-username"></label>
                        <input style="width: 280px" type="text" id="user" name="username" required  lay-verify="required" placeholder="请输入昵称" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-inline" style="float: left;margin-top: 7px">
                        <i class="layui-icon" id="ri" style="color: green;font-weight: bolder;" hidden></i>
                    </div>
                    <div class="layui-inline" style="float: left">
                        <i class="layui-icon" id="wr" style="color: red; font-weight: bolder;" hidden>ဆ</i>
                    </div>
                </div>
                <div class="layui-form layui-form-item">
                    <div class="layui-inline" style="float: left">
                        <label class="layui-icon layui-icon-vercode"></label>
                        <input style="width: 280px" type="password" id="pwd" name="password" required  lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-inline" style="float: left;margin-top: 7px">
                        <i class="layui-icon" id="pri" style="color: green;font-weight: bolder;" hidden></i>
                    </div>
                    <div class="layui-inline" style="float: left">
                        <i class="layui-icon" id="pwr" style="color: red; font-weight: bolder;" hidden>ဆ</i>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline" style="float: left">
                        <label class="layui-icon layui-icon-auz"></label>
                        <input style="width: 280px" type="password" id="rpwd" name="repassword" required  lay-verify="required" placeholder="请确认密码" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-inline" style="float: left;margin-top: 7px">
                        <i class="layui-icon" id="rpri" style="color: green;font-weight: bolder;" hidden></i>
                    </div>
                    <div class="layui-inline" style="float: left">
                        <i class="layui-icon" id="rpwr" style="color: red; font-weight: bolder;" hidden>ဆ</i>
                    </div>
                </div>
                <div class="layui-form-item">
                    <button style="width: 320px" type="submit" lay-submit lay-filter="submit" class="layui-btn">注册</button>
                </div>
                <hr class="layui-bg-orange"/>
                <p><a href="javascript:void(0);" onclick="login()" class="fr">已有账号？立即登录</a></p><br>
            </form>
        </div>
    </div>
</div>

<script th:src="@{/static/js/jquery-3.4.1.js}"></script>
<script th:src="@{/static/layui/layui.js}"></script>
<script th:src="@{/static/dream/localhost.js}"></script>
<script th:src="@{/static/js/jquery.particleground.min.js}"></script>
<script type="text/javascript">

    //动态切换
    function register() {
        var login = document.getElementById("login-form");
        var register = document.getElementById("register-form");
        login.style.display = 'none';
        register.style.display = 'block';
    }
    function login() {
        var login = document.getElementById("login-form");
        var register = document.getElementById("register-form");
        login.style.display = 'flow';
        register.style.display = 'none';
    }

    // 粒子线条背景
    $(document).ready(function(){
        $('.layui-container').particleground({
            dotColor:'#5cbdaa',
            lineColor:'#5cbdaa'
        });
    });

    //登录
    layui.use(['form','layer','jquery'], function () {
        const form = layui.form;
        const $ = layui.jquery;
        form.on('submit(login)',function (data) {
            $.ajax({
                url: host + 'user/login',
                data:data.field,
                dataType:'json',
                type:'post',
                success:function (result) {
                    if (result.status === 200){
                        location.href = "admin/index";
                    } else if (result.status === 100) {
                        $('#code').val("");
                        const codeImage = document.getElementById("codeImage");
                        codeImage.src= host + 'user/captcha?'+Math.random();
                        layer.msg(result.msg);
                    } else if (result.status === 201) {
                        $('#username').val("");
                        layer.msg(result.msg);
                    } else if (result.status === 202){
                        $('#username').val("");
                        $('#password').val("");
                        layer.msg(result.msg);
                    }else {
                        layer.msg(result.msg);
                    }
                }
            });
            return false;
        });
    });

    //注册
    layui.use(['form','jquery','layer'], function () {
        var form   = layui.form;
        var $      = layui.jquery;
        var layer  = layui.layer;

        //添加表单失焦事件 并验证数据
        $('#user').blur(function() {
            var user = $(this).val();
            // 为用户名添加正则验证
            var reg = /^[\w]{3,12}$/;
            if(!($('#user').val().match(reg))){
                $('#wr').removeAttr('hidden');
                $('#ri').attr('hidden','hidden');
                layer.msg('请输入3到12位合法用户名');
            } else {
                $('#ri').removeAttr('hidden');
                $('#wr').attr('hidden','hidden');
                $.ajax({
                    url: host + 'user/check',
                    type:'post',
                    dataType:'json',
                    data:{username:user},
                    //验证用户名是否可用
                    success:function(result){
                        if (result.status === 200) {
                            $('#ri').removeAttr('hidden');
                            $('#wr').attr('hidden','hidden');
                            layer.msg('当前用户名可用! ')
                        } else if (result.status === 202) {
                            $('#wr').removeAttr('hidden');
                            $('#ri').attr('hidden','hidden');
                            layer.msg('用户名仅限数字与字母 ')
                        } else {
                            $('#wr').removeAttr('hidden');
                            $('#ri').attr('hidden','hidden');
                            layer.msg('当前用户名已被占用! ')
                        }
                    }
                })
            }
        });

        // 为密码添加正则验证
        $('#pwd').blur(function() {
            var reg = /^[\w]{6,12}$/;
            if(!($('#pwd').val().match(reg))){
                $('#pwr').removeAttr('hidden');
                $('#pri').attr('hidden','hidden');
                layer.msg('请输入6到12位合法密码');
            }else {
                $('#pri').removeAttr('hidden');
                $('#pwr').attr('hidden','hidden');
            }
        });

        //验证两次密码是否一致
        $('#rpwd').blur(function() {
            var reg = /^[\w]{6,12}$/;
            if(!($('#rpwd').val().match(reg))) {
                $('#rpwr').removeAttr('hidden');
                $('#rpri').attr('hidden', 'hidden');
                layer.msg('请输入6到12位合法密码');
            } else if($('#pwd').val() !== $('#rpwd').val()){
                $('#rpwr').removeAttr('hidden');
                $('#rpri').attr('hidden','hidden');
            } else {
                $('#rpri').removeAttr('hidden');
                $('#rpwr').attr('hidden','hidden');
            }
        });

        //添加表单监听事件,提交注册信息
        form.on('submit(submit)', function(data) {
            console.log(data.field);
            if (data.field.password !== data.field.repassword ) {
                layer.msg('两次输入密码不一致');
                return false;
            }
            $.ajax({
                url: host + 'user/add',
                type:'post',
                dataType:'json',
                data:JSON.stringify(data.field),
                contentType: "application/json;charset=UTF-8",
                success:function(result){
                    if (result.status === 200) {
                        layer.msg(result.msg);
                        setTimeout(function () {
                            var login = document.getElementById("login-form");
                            var register = document.getElementById("register-form");
                            login.style.display = 'flow';
                            register.style.display = 'none';
                        },3000);
                    } else if (result.status === 202){
                        layer.msg(result.msg)
                    } else {
                        layer.msg(result.msg)
                    }
                }
            });
            return false;
        });
    });

</script>
</body>
</html>