<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>后台管理系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" th:href="@{/static/layuiadmin/layui/css/layui.css}" media="all">
    <link rel="stylesheet" th:href="@{/static/layuiadmin/style/admin.css}" media="all">
    <link rel="stylesheet" th:href="@{/static/css/userInfo.css}" >
    <link rel="stylesheet" th:href="@{/static/css/index.css}" >
    <link rel="stylesheet" th:href="@{/static/editormd/css/editormd.min.css}" >
    <link rel="shortcut icon" th:href="@{/static/favicon.ico}" type="image/x-icon">
    <!-- 页面解析markdown为HTML显示需要的css -->
    <link rel="stylesheet" th:href="@{/static/editormd/css/editormd.preview.min.css}" />
    <script>
        /^http(s*):\/\//.test(location.href) || alert('请先部署到 localhost 下再访问');
    </script>
</head>

<body>

<div class="layui-fluid" lay-title="添加表单">
    <div class="layui-row">
        <div class="layui-card">
            <div class="layui-card-body" style="padding: 15px;">
                <form class="layui-form" action="" id="example" lay-filter="example">

                    <div class="layui-form-item">
                        <label class="layui-form-label">职位名称：</label>
                        <div class="layui-input-block">
                            <input type="text" name="workName" id="workName" lay-verify="required" placeholder="请输入职位名称"
                                   autocomplete="false" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">薪资水平：</label>
                            <div class="layui-input-inline">
                                <input type="text" name="workPay" id="workPay" lay-verify="required" autocomplete="false" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">招聘人数：</label>
                            <div class="layui-input-inline">
                                <input type="text" name="workNumber" id="workNumber" placeholder="请填写数字" lay-verify="required|number" autocomplete="false" class="layui-input">
                            </div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">学历要求：</label>
                        <div class="layui-input-block">
                            <input type="text" name="workCondition" id="workCondition" placeholder="请输入职位要求" autocomplete="false" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">工作地址：</label>
                        <div class="layui-input-block">
                            <input type="text" name="workAddress" id="workAddress" lay-verify="required" autocomplete="false" placeholder="请输入工作地址" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">截止日期：</label>
                            <div class="layui-input-inline">
                                <input type="text" name="workDate" id="workDate" placeholder="yyyy-MM-dd" class="layui-input">
                            </div>
                        </div>

                        <div class="layui-inline">
                            <label class="layui-form-label">职位分类：</label>
                            <div class="layui-input-inline">
                                <select id="select" name="categoryId" lay-verify="required" lay-filter="select">
                                    <option value=""></option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="layui-form-item">

                        <div class="layui-inline">
                            <label class="layui-form-label">联系人：</label>
                            <div class="layui-input-inline">
                                <input type="text" id="workPerson" name="workPerson" class="layui-input" autocomplete="false">
                            </div>
                        </div>

                        <div class="layui-inline">
                            <label class="layui-form-label">联系方式：</label>
                            <div class="layui-input-inline">
                                <input type="tel" id="workPhone" name="workPhone" lay-verify="phone" class="layui-input" autocomplete="false">
                            </div>
                        </div>

                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">是否发布：</label>
                        <div class="layui-input-block">
                            <input type="radio" name="workStatus" value="0" title="是">
                            <input type="radio" name="workStatus" value="1" title="否">
                        </div>
                    </div>

                    <div class="layui-form-item layui-form-text">
                        <label class="layui-form-label">工作描述：</label>
                        <div class="layui-input-block">
                            <textarea id="workDescription" name="workDescription" placeholder="请输入工作描述" class="layui-textarea" autocomplete="false"></textarea>
                        </div>
                    </div>

                    <div class="layui-form-item layui-form-text">
                        <label class="layui-form-label">公司介绍：</label>
                        <div class="layui-input-block">
                            <div class="layui-textarea" id="content" name="content">
                                <textarea style="display:none"></textarea>
                            </div>
                        </div>
                    </div>

                    <input type="hidden" id="userId" name="userId" th:value="${user.getId()}">

                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button class="layui-btn layui-btn-normal" id="formSubmit" lay-submit="" lay-filter="formSubmit">立即提交</button>
                            <!--此处应避免用reset关键词来命名reset按钮的name和id属性，会造成Form表单无法提交-->
                            <button class="layui-btn layui-btn-primary" id="ResetButton" lay-filter="ResetButton">重置</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<script th:src="@{/static/js/jquery-3.4.1.js}"></script>
<script th:src="@{/static/js/jquery.nicescroll.js}"></script>
<script th:src="@{/static/layui/layui.js}"></script>
<script th:src="@{/static/editormd/editormd.min.js}" type="text/javascript"></script>
<script th:src="@{/static/dream/localhost.js}"></script>
<script data-th-inline="none" type="text/javascript">

    layui.use(['jquery','layer','form', 'laydate'], function(){
        var $ = layui.layer;
        $ = layui.jquery;
        var form = layui.form;
        var layer = layui.layer;
        var laydate = layui.laydate;
        loadSelect();
        laydate.render({
            elem: '#workDate'
        });

        /*下拉框数据获取*/
        function loadSelect() {
            $.ajax({
                type: 'get',
                dataType: 'json',
                url: host + 'admin/categories',
                success: function (result) {
                    var data = result.data.data;
                    var root = document.getElementById("select");
                    for (var i = 0; i <data.length;i++) {
                        var option = document.createElement("option");
                        option.setAttribute("value",data[i].id);
                        option.innerText = data[i].title;
                        root.appendChild(option);
                        form.render('select');
                    }
                }
            });
        }

        var testEditor = editormd("content", {
            width: "100%",
            height: 500,
            path : '/static/editormd/lib/',
            theme : "default",
            previewTheme : "default",
            editorTheme : "default",
            codeFold : true,
            saveHTMLToTextarea : true,
            searchReplace : true,
            watch : true,
            htmlDecode : "style,script,iframe|on*",

            taskList : true,
            tocm: true,
            tex : true,
            flowChart : true,
            sequenceDiagram : true,
            // 是否开启上传图片功能
            imageUpload : false,
            imageFormats : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            // 文件上传路径，返回值为图片加载的路径
            imageUploadURL : "",
            onload : function() {

            }
        });

        /*清空表单*/
        function formReset(){
            document.getElementById("example").reset();
            testEditor.setMarkdown(null);
        }

        //这一手偷梁换柱 有人懂不 哈哈哈
        form.on('submit(ResetButton)',function () {
            formReset();
        });

        form.on('submit(formSubmit)',function () {
            var workName = $('#workName').val();
            var workNumber = $('#workNumber').val();
            var workPay = $('#workPay').val();

            var workAddress = $('#workAddress').val();
            var workCondition = $('#workCondition').val();
            var categoryId = $('#select').val();

            var workDate = $('#workDate').val();
            var workPhone = $('#workPhone').val();
            var workPerson = $('#workPerson').val();

            var workDescription = $('#workDescription').val();
            var workStatus = $("input[name='workStatus']:checked").val();
            var content = testEditor.getMarkdown();
            var userId = $('#userId').val();

            var bml = {
                workName: workName,
                workPay: workPay,
                workNumber: workNumber,

                workAddress: workAddress,
                workCondition: workCondition,
                categoryId: categoryId,

                workDate: workDate,
                workPhone: workPhone,
                workPerson: workPerson,

                workDescription: workDescription,
                workStatus: workStatus,
                companyDescription: content,
                userId: userId,
            };
            $.ajax({
                url: host + 'admin/work',
                type: 'POST',
                data: JSON.stringify(bml),
                dataType: 'json',
                contentType: "application/json;charset=UTF-8",
                success: function (result) {
                    if (result.status === 200) {
                        formReset();
                        layer.msg(result.msg)
                    }else {
                        layer.msg(result.msg)
                    }
                },
                error: function () {
                    layer.msg("未知错误 添加失败!")
                }
            });
            return false;
        });
    });

</script>
</body>
</html>